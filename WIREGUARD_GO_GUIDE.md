# ğŸ”§ WireGuard-Go å®Œæ•´æŒ‡å—

> åŸºäºå®˜æ–¹ WireGuard-Go çš„å¢å¼ºå®ç°ï¼ŒåŒ…å«è‡ªåˆ¶ç®¡ç†å·¥å…·å’Œè‡ªåŠ¨åŒ–è„šæœ¬

## ğŸ“‹ ç›®å½•
- [é¡¹ç›®æ¦‚è¿°](#-é¡¹ç›®æ¦‚è¿°)
- [é¡¹ç›®ç»“æ„](#-é¡¹ç›®ç»“æ„)
- [ç¯å¢ƒå‡†å¤‡](#-ç¯å¢ƒå‡†å¤‡)
- [å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹)
- [è¯¦ç»†ä½¿ç”¨](#-è¯¦ç»†ä½¿ç”¨)
- [å‘½ä»¤å‚è€ƒ](#-å‘½ä»¤å‚è€ƒ)
- [æ•…éšœæ’é™¤](#-æ•…éšœæ’é™¤)
- [æŠ€æœ¯è¯´æ˜](#-æŠ€æœ¯è¯´æ˜)

---

## ğŸŒŸ é¡¹ç›®æ¦‚è¿°

### ç‰¹è‰²åŠŸèƒ½
- **ğŸ”§ wg-go ç®¡ç†å·¥å…·**: è‡ªåˆ¶çš„ Go ç‰ˆæœ¬ WireGuard ç®¡ç†å·¥å…·
- **ğŸš€ è‡ªåŠ¨åŒ–è„šæœ¬**: ä¸€é”®å¯åŠ¨å’Œåœæ­¢è„šæœ¬ (æ”¯æŒ Windows/Linux/macOS)
- **ğŸŒ æ™ºèƒ½åŸŸåè§£æ**: è‡ªåŠ¨å°†åŸŸåè§£æä¸º IP åœ°å€
- **ğŸ”„ åŠ¨æ€ DNS ç›‘æ§**: è‡ªåŠ¨ç›‘æ§åŸŸåç«¯ç‚¹çš„ IP å˜åŒ–å¹¶é‡æ–°è¿æ¥
- **ğŸ”‘ æ™ºèƒ½å¯†é’¥è½¬æ¢**: Base64 â†” Hex æ ¼å¼è‡ªåŠ¨è½¬æ¢
- **ğŸ“Š å®æ—¶ç›‘æ§**: è¿æ¥çŠ¶æ€å’Œæµé‡ç»Ÿè®¡çš„å®æ—¶ç›‘æ§
- **ğŸ–¥ï¸ è·¨å¹³å°æ”¯æŒ**: å®Œæ•´æ”¯æŒ Windowsã€Linuxã€macOS

### è§£å†³çš„é—®é¢˜
1. **å®˜æ–¹ wg å·¥å…·ä¾èµ–**: æ— éœ€å®‰è£… wireguard-tools
2. **åŠ¨æ€ IP é—®é¢˜**: è‡ªåŠ¨ç›‘æ§å’Œå¤„ç†åŸŸåç«¯ç‚¹çš„ IP å˜åŒ–
3. **åŸŸåè§£æ**: æ”¯æŒåŸŸåç«¯ç‚¹ï¼Œè‡ªåŠ¨è§£æä¸º IP
4. **è¶…æ—¶å¤„ç†**: é˜²æ­¢å‘½ä»¤æŒ‚èµ·çš„æ™ºèƒ½è¶…æ—¶
5. **æƒé™ç®¡ç†**: å‹å¥½çš„æƒé™æ£€æŸ¥å’Œæç¤º

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
wireguard-go/
â”œâ”€â”€ ğŸ”§ æ ¸å¿ƒç¨‹åº
â”‚   â”œâ”€â”€ wireguard-go              # WireGuard å®ˆæŠ¤è¿›ç¨‹
â”‚   â””â”€â”€ cmd/wg-go/
â”‚       â”œâ”€â”€ main.go               # ä¸»ç¨‹åºå…¥å£
â”‚       â”œâ”€â”€ commands.go           # å‘½ä»¤å¤„ç†é€»è¾‘
â”‚       â”œâ”€â”€ uapi.go               # UAPI é€šä¿¡ (å«åŸŸåè§£æ)
â”‚       â”œâ”€â”€ crypto.go             # å¯†é’¥ç”Ÿæˆå’Œç®¡ç†
â”‚       â”œâ”€â”€ monitor.go            # å®æ—¶ç›‘æ§åŠŸèƒ½
â”‚       â”œâ”€â”€ go.mod                # Go æ¨¡å—æ–‡ä»¶
â”‚       â””â”€â”€ go.sum                # ä¾èµ–æ ¡éªŒæ–‡ä»¶
â”‚
â”œâ”€â”€ ğŸš€ è‡ªåŠ¨åŒ–è„šæœ¬
â”‚   â”œâ”€â”€ quick-start.sh            # ä¸€é”®å¯åŠ¨è„šæœ¬
â”‚   â””â”€â”€ stop-wireguard.sh         # ä¸€é”®åœæ­¢è„šæœ¬
â”‚
â”œâ”€â”€ ğŸ“„ é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ wg0.conf                  # WireGuard é…ç½®ç¤ºä¾‹
â”‚
â”œâ”€â”€ ğŸ“š æ–‡æ¡£
â”‚   â”œâ”€â”€ WIREGUARD_GO_GUIDE.md     # å®Œæ•´æŒ‡å—
â”‚   â””â”€â”€ README.md                 # åŸå§‹ WireGuard-Go README
â”‚
â””â”€â”€ ğŸ“¦ åŸå§‹ WireGuard-Go æºç 
    â”œâ”€â”€ conn/                     # ç½‘ç»œè¿æ¥å¤„ç†
    â”œâ”€â”€ device/                   # è®¾å¤‡ç®¡ç†
    â”œâ”€â”€ ipc/                      # è¿›ç¨‹é—´é€šä¿¡
    â”œâ”€â”€ tun/                      # TUN æ¥å£å¤„ç†
    â””â”€â”€ ...                       # å…¶ä»–åŸå§‹æ–‡ä»¶
```

---

## ğŸ”§ ç¯å¢ƒå‡†å¤‡

### ç³»ç»Ÿè¦æ±‚
- **æ“ä½œç³»ç»Ÿ**: macOS 10.15+ (å…¶ä»– Unix ç³»ç»Ÿéœ€æµ‹è¯•)
- **Go ç‰ˆæœ¬**: Go 1.19+
- **æƒé™**: sudo æƒé™ (é…ç½®ç½‘ç»œæ¥å£éœ€è¦)

### ç¯å¢ƒæ£€æŸ¥
```bash
# æ£€æŸ¥ Go ç‰ˆæœ¬
go version

# æ£€æŸ¥æƒé™
sudo echo "æƒé™æ£€æŸ¥é€šè¿‡"

# æ£€æŸ¥ç½‘ç»œå·¥å…·
ifconfig utun0 >/dev/null 2>&1 && echo "ç½‘ç»œæƒé™æ­£å¸¸"
```

### ç¼–è¯‘é¡¹ç›®

#### Linux/macOS ç”¨æˆ·
```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd wireguard-go

# 1. ç¼–è¯‘ WireGuard å®ˆæŠ¤è¿›ç¨‹
make build
# æˆ–è€…ä½¿ç”¨ go build
go build -o wireguard-go main.go

# 2. ç¼–è¯‘ wg-go ç®¡ç†å·¥å…·
cd cmd/wg-go
go build -o wg-go .
cd ../..

# éªŒè¯ç¼–è¯‘ç»“æœ
./cmd/wg-go/wg-go help
ls -la wireguard-go cmd/wg-go/wg-go
```

#### Windows ç”¨æˆ·
```cmd
REM è¿›å…¥é¡¹ç›®ç›®å½•
cd wireguard-go

REM 1. ç¼–è¯‘ WireGuard å®ˆæŠ¤è¿›ç¨‹
go build -o wireguard-go.exe .

REM 2. ç¼–è¯‘ wg-go ç®¡ç†å·¥å…·
cd cmd\wg-go
go build -o wg-go.exe .
cd ..\..

REM éªŒè¯ç¼–è¯‘ç»“æœ
cmd\wg-go\wg-go.exe help
dir wireguard-go.exe cmd\wg-go\wg-go.exe
```

#### ä½¿ç”¨æ„å»ºè„šæœ¬

**Linux/macOS ç”¨æˆ· (ä½¿ç”¨ Makefile):**
```bash
# æŸ¥çœ‹å¸®åŠ©
make help

# æ„å»ºå½“å‰å¹³å°
make build

# æ„å»ºæ‰€æœ‰å¹³å°
make build-all

# æ„å»ºå‘½ä»¤è¡Œå·¥å…·
make build-tools

# æ¸…ç†
make clean
```

**Windows ç”¨æˆ· (ä½¿ç”¨ build.bat):**
```cmd
REM æŸ¥çœ‹å¸®åŠ©
build.bat help

REM æ„å»ºå½“å‰å¹³å° (Windows)
build.bat build

REM æ„å»ºæ‰€æœ‰å¹³å°
build.bat build-all

REM æ„å»ºå‘½ä»¤è¡Œå·¥å…·
build.bat build-tools

REM æ¸…ç†
build.bat clean
```

**Windows ç”¨æˆ· (ä½¿ç”¨ Make, éœ€è¦å…ˆå®‰è£…):**
```cmd
REM å®‰è£… Make (ä½¿ç”¨ Chocolatey)
choco install make

REM æˆ–è€…ä½¿ç”¨ Scoop
scoop install make

REM ç„¶åä½¿ç”¨ Makefile
make help
make build
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### Windows ç”¨æˆ· (æ¨è)

1. **ä¸‹è½½å¹¶å®‰è£… Go**: https://golang.org/dl/
2. **å…‹éš†é¡¹ç›®**: `git clone <your-repo> && cd wireguard-go`
3. **è¿è¡Œæµ‹è¯•**: `test-windows-support.bat` (ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ)
4. **å¿«é€Ÿå¯åŠ¨**: `quick-start-windows.bat` (ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ)
5. **åœæ­¢æœåŠ¡**: `stop-wireguard-windows.bat` (ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ)

**Windows ç‰¹æ€§æ”¯æŒ**:
- âœ… **wg-go å‘½ä»¤è¡Œå·¥å…·**: å®Œå…¨æ”¯æŒ Windows å‘½åç®¡é“é€šä¿¡
- âœ… **åŠ¨æ€ DNS ç›‘æ§**: è‡ªåŠ¨ç›‘æ§åŸŸå IP å˜åŒ–
- âœ… **æ—¥å¿—ç³»ç»Ÿ**: æ”¯æŒæ–‡ä»¶è¾“å‡ºå’Œæ§åˆ¶å°è¾“å‡º
- âœ… **UAPI é€šä¿¡**: ä½¿ç”¨ Windows å‘½åç®¡é“ (`\\.\pipe\wireguard\<interface>`)
- âœ… **ç®¡ç†å‘˜æƒé™**: è‡ªåŠ¨æ£€æµ‹å¹¶æä¾›æƒé™æç¤º
- âš ï¸ **ç½‘ç»œé…ç½®**: éœ€è¦æ‰‹åŠ¨é…ç½®TUNæ¥å£IPåœ°å€å’Œè·¯ç”± (ä¸å®˜æ–¹WireGuard for Windowsä¸åŒ)

### Windows ç”¨æˆ·è¯¦ç»†é…ç½®

#### é‡è¦è¯´æ˜
WireGuard-Goåœ¨Windowsä¸Šä¸å®˜æ–¹WireGuard for Windowsæœ‰ä¸€ä¸ªé‡è¦åŒºåˆ«ï¼š**ä¸ä¼šè‡ªåŠ¨é…ç½®TUNæ¥å£çš„IPåœ°å€å’Œè·¯ç”±**ã€‚éœ€è¦æ‰‹åŠ¨é…ç½®ç½‘ç»œæ¥å£ã€‚

#### 1. å‡†å¤‡é…ç½®æ–‡ä»¶

ç¼–è¾‘ `wg0.conf`:
```ini
[Interface]
# ç”Ÿæˆå‘½ä»¤: ./cmd/wg-go/wg-go.exe genkey
PrivateKey = YOUR_PRIVATE_KEY
Address = 192.168.11.35/32
DNS = 8.8.8.8
MTU = 1420

[Peer]
PublicKey = SERVER_PUBLIC_KEY
# æ”¯æŒåŸŸåï¼Œä¼šè‡ªåŠ¨è§£æä¸º IP å¹¶ç›‘æ§ IP å˜åŒ–
# å½“åŸŸåçš„ IP åœ°å€å˜åŒ–æ—¶ï¼Œä¼šè‡ªåŠ¨é‡æ–°è¿æ¥
Endpoint = server.example.com:51820
AllowedIPs = 192.168.11.0/24, 192.168.10.0/24
PersistentKeepalive = 25
```

#### 2. ç”Ÿæˆå¯†é’¥å¯¹
```cmd
REM ç”Ÿæˆç§é’¥
cmd\wg-go\wg-go.exe genkey

REM ç”Ÿæˆå¯¹åº”çš„å…¬é’¥
echo PRIVATE_KEY | cmd\wg-go\wg-go.exe pubkey

REM ç”Ÿæˆé¢„å…±äº«å¯†é’¥
cmd\wg-go\wg-go.exe genpsk
```

#### 3. ä¸€é”®å¯åŠ¨ (æ¨è)
```cmd
REM ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ
quick-start-windows.bat
```

#### 4. æ‰‹åŠ¨å¯åŠ¨å’Œé…ç½®
```cmd
REM 1. å¯åŠ¨WireGuardå®ˆæŠ¤è¿›ç¨‹
wireguard-go.exe wg0

REM 2. åº”ç”¨é…ç½®
cmd\wg-go\wg-go.exe setconf wg0 wg0.conf

REM 3. æ‰‹åŠ¨é…ç½®ç½‘ç»œæ¥å£ (é‡è¦!)
REM è®¾ç½®æ¥å£IPåœ°å€
netsh interface ip set address "wg0" static 192.168.101.20 255.255.255.0

REM æ·»åŠ è·¯ç”±åˆ°å¯¹ç­‰ç½‘ç»œ
route add 192.168.100.0 mask 255.255.255.0 192.168.101.20
route add 192.168.101.0 mask 255.255.255.0 192.168.101.20

REM è®¾ç½®DNSæœåŠ¡å™¨
netsh interface ip set dns "wg0" static 8.8.8.8
```

#### 5. éªŒè¯è¿æ¥
```cmd
REM æŸ¥çœ‹è¿æ¥çŠ¶æ€
cmd\wg-go\wg-go.exe show wg0

REM æ£€æŸ¥ç½‘ç»œæ¥å£
ipconfig

REM æ£€æŸ¥è·¯ç”±è¡¨
route print | findstr "192.168"

REM æµ‹è¯•è¿é€šæ€§
ping 192.168.100.1
```

#### 6. åœæ­¢æœåŠ¡
```cmd
REM è‡ªåŠ¨åœæ­¢ (æ¨è)
stop-wireguard-windows.bat

REM æ‰‹åŠ¨åœæ­¢
REM åœæ­¢WireGuardè¿›ç¨‹
taskkill /f /im wireguard-go.exe

REM æ¸…ç†è·¯ç”±
route delete 192.168.100.0
route delete 192.168.101.0

REM é‡ç½®æ¥å£é…ç½® (å¯é€‰)
netsh interface ip set address "wg0" dhcp
netsh interface ip set dns "wg0" dhcp
```

**åœæ­¢è„šæœ¬åŠŸèƒ½**:
- âœ… **è‡ªåŠ¨åœæ­¢è¿›ç¨‹**: æ­£å¸¸åœæ­¢æˆ–å¼ºåˆ¶åœæ­¢WireGuardè¿›ç¨‹
- âœ… **æ¸…ç†è·¯ç”±**: è‡ªåŠ¨åˆ é™¤å¯¹ç­‰ç½‘ç»œè·¯ç”±
- âœ… **æ¥å£é‡ç½®**: å¯é€‰æ‹©é‡ç½®wg0æ¥å£ä¸ºDHCPæ¨¡å¼
- âœ… **çŠ¶æ€æ£€æŸ¥**: æ˜¾ç¤ºæ¸…ç†ç»“æœå’Œæ¥å£çŠ¶æ€

### Linux/macOS ç”¨æˆ·

#### 1. å‡†å¤‡é…ç½®æ–‡ä»¶

ç¼–è¾‘ `wg0.conf`:

### 2. ç”Ÿæˆå¯†é’¥å¯¹
```bash
# ç”Ÿæˆç§é’¥
PRIVATE_KEY=$(./cmd/wg-go/wg-go genkey)

# ç”Ÿæˆå¯¹åº”çš„å…¬é’¥
PUBLIC_KEY=$(echo "$PRIVATE_KEY" | ./cmd/wg-go/wg-go pubkey)

echo "ç§é’¥: $PRIVATE_KEY"
echo "å…¬é’¥: $PUBLIC_KEY"
```

### 3. ä¸€é”®å¯åŠ¨
```bash
# è‡ªåŠ¨å¯åŠ¨ (æ¨è)
sudo ./quick-start.sh

# æ‰‹åŠ¨å¯åŠ¨
sudo ./wireguard-go utun11 &
sudo ./cmd/wg-go/wg-go setconf utun11 wg0.conf
sudo ifconfig utun11 inet 192.168.11.35 192.168.11.35 netmask 255.255.255.255
sudo route add -net 192.168.11.0/24 -interface utun11
sudo route add -net 192.168.10.0/24 -interface utun11
```

### 4. éªŒè¯è¿æ¥
```bash
# æŸ¥çœ‹è¿æ¥çŠ¶æ€
sudo ./cmd/wg-go/wg-go show utun11

# æµ‹è¯•ç½‘ç»œè¿é€šæ€§
ping -c 3 192.168.11.21

# å®æ—¶ç›‘æ§
sudo ./cmd/wg-go/wg-go monitor utun11
```

### 5. åœæ­¢æœåŠ¡
```bash
# è‡ªåŠ¨åœæ­¢ (æ¨è)
sudo ./stop-wireguard.sh

# æ‰‹åŠ¨åœæ­¢
sudo pkill wireguard-go
```

---

## ğŸ“– è¯¦ç»†ä½¿ç”¨

### é…ç½®æ–‡ä»¶è¯¦è§£

#### Interface æ®µ
```ini
[Interface]
PrivateKey = base64_encoded_private_key    # å¿…éœ€: æœ¬åœ°ç§é’¥
Address = 192.168.11.35/32                # å¿…éœ€: æœ¬åœ° VPN IP
ListenPort = 51820                        # å¯é€‰: ç›‘å¬ç«¯å£ (é»˜è®¤éšæœº)
DNS = 8.8.8.8, 1.1.1.1                   # å¯é€‰: DNS æœåŠ¡å™¨
MTU = 1420                                # å¯é€‰: æœ€å¤§ä¼ è¾“å•å…ƒ
```

#### Peer æ®µ
```ini
[Peer]
PublicKey = base64_encoded_public_key      # å¿…éœ€: å¯¹ç«¯å…¬é’¥
Endpoint = server.com:51820               # å¯é€‰: æœåŠ¡å™¨åœ°å€ (æ”¯æŒåŸŸå)
AllowedIPs = 192.168.11.0/24             # å¿…éœ€: å…è®¸çš„ IP èŒƒå›´
PresharedKey = base64_encoded_psk         # å¯é€‰: é¢„å…±äº«å¯†é’¥
PersistentKeepalive = 25                  # å¯é€‰: ä¿æ´»é—´éš” (ç§’)
```

### ç½‘ç»œé…ç½®è¯¦è§£

#### 1. æ¥å£é…ç½®
```bash
# é…ç½® IP åœ°å€ (point-to-point æ¥å£éœ€è¦ç›¸åŒçš„æºå’Œç›®æ ‡)
sudo ifconfig utun11 inet LOCAL_IP LOCAL_IP netmask 255.255.255.255

# æŸ¥çœ‹æ¥å£çŠ¶æ€
ifconfig utun11
```

#### 2. è·¯ç”±é…ç½®
```bash
# æ·»åŠ åˆ° VPN ç½‘ç»œçš„è·¯ç”±
sudo route add -net NETWORK/CIDR -interface utun11

# ç¤ºä¾‹: æ·»åŠ å¤šä¸ªç½‘ç»œ
sudo route add -net 192.168.11.0/24 -interface utun11
sudo route add -net 192.168.10.0/24 -interface utun11

# æŸ¥çœ‹è·¯ç”±è¡¨
netstat -rn | grep utun11
```

#### 3. å…¨å±€ VPN (å¯é€‰)
```bash
# è­¦å‘Š: è¿™ä¼šå°†æ‰€æœ‰æµé‡é€šè¿‡ VPNï¼Œå°å¿ƒä½¿ç”¨!

# ä¿å­˜å½“å‰é»˜è®¤è·¯ç”±
DEFAULT_GW=$(route -n get default | grep gateway | awk '{print $2}')

# ç¡®ä¿ VPN æœåŠ¡å™¨ä¸èµ° VPN (é¿å…å¾ªç¯)
sudo route add SERVER_IP $DEFAULT_GW

# è®¾ç½® VPN ä¸ºé»˜è®¤è·¯ç”±
sudo route add -net 0.0.0.0/1 -interface utun11
sudo route add -net 128.0.0.0/1 -interface utun11
```

### ç›‘æ§å’Œè°ƒè¯•

#### 1. è¿æ¥çŠ¶æ€ç›‘æ§
```bash
# æŸ¥çœ‹è¯¦ç»†çŠ¶æ€
sudo ./cmd/wg-go/wg-go show utun11

# å®æ—¶ç›‘æ§ (é»˜è®¤ 5 ç§’é—´éš”)
sudo ./cmd/wg-go/wg-go monitor utun11

# è‡ªå®šä¹‰ç›‘æ§é—´éš”
sudo ./cmd/wg-go/wg-go monitor utun11 10

# ç›‘æ§æ‰€æœ‰æ¥å£
sudo ./cmd/wg-go/wg-go monitor
```

#### 2. è¿æ¥æµ‹è¯•
```bash
# æµ‹è¯•åˆ° VPN ç½‘ç»œçš„è¿é€šæ€§
ping -c 3 192.168.11.1

# æµ‹è¯•ç‰¹å®šä¸»æœº
ping -c 3 192.168.11.21

# ç½‘ç»œæ‰«æ (å¦‚æœå¯ç”¨)
nmap -sn 192.168.11.0/24
```

#### 3. æµé‡ç»Ÿè®¡
```bash
# æŸ¥çœ‹æ•°æ®ä¼ è¾“ç»Ÿè®¡
sudo ./cmd/wg-go/wg-go show utun11 | grep "transfer"

# å®æ—¶æµé‡ç›‘æ§
watch -n 2 'sudo ./cmd/wg-go/wg-go show utun11 | grep transfer'
```

---

## ğŸ“š å‘½ä»¤å‚è€ƒ

### wg-go å·¥å…·å®Œæ•´å‘½ä»¤

#### å¯†é’¥ç®¡ç†
```bash
./cmd/wg-go/wg-go genkey                    # ç”Ÿæˆç§é’¥
./cmd/wg-go/wg-go genkey | ./cmd/wg-go/wg-go pubkey  # ç”Ÿæˆå¯†é’¥å¯¹
echo "PRIVATE_KEY" | ./cmd/wg-go/wg-go pubkey        # ä»ç§é’¥ç”Ÿæˆå…¬é’¥
./cmd/wg-go/wg-go genpsk                    # ç”Ÿæˆé¢„å…±äº«å¯†é’¥
```

#### é…ç½®ç®¡ç†
```bash
sudo ./cmd/wg-go/wg-go show                 # æ˜¾ç¤ºæ‰€æœ‰æ¥å£
sudo ./cmd/wg-go/wg-go show utun11           # æ˜¾ç¤ºç‰¹å®šæ¥å£
sudo ./cmd/wg-go/wg-go setconf utun11 wg0.conf      # åº”ç”¨é…ç½®æ–‡ä»¶
sudo ./cmd/wg-go/wg-go showconf utun11       # æ˜¾ç¤ºé…ç½®æ ¼å¼
sudo ./cmd/wg-go/wg-go addconf utun11 peer.conf     # æ·»åŠ  peer
sudo ./cmd/wg-go/wg-go syncconf utun11 wg0.conf     # åŒæ­¥é…ç½®
```

#### ç›‘æ§åŠŸèƒ½
```bash
sudo ./cmd/wg-go/wg-go monitor              # ç›‘æ§æ‰€æœ‰æ¥å£
sudo ./cmd/wg-go/wg-go monitor utun11        # ç›‘æ§ç‰¹å®šæ¥å£
sudo ./cmd/wg-go/wg-go monitor utun11 10     # è‡ªå®šä¹‰æ›´æ–°é—´éš”
```

#### DNS ç›‘æ§ç®¡ç† (æ–°åŠŸèƒ½)
```bash
sudo ./cmd/wg-go/wg-go dns utun11 show       # æ˜¾ç¤º DNS ç›‘æ§çŠ¶æ€
sudo ./cmd/wg-go/wg-go dns utun11 30         # è®¾ç½®ç›‘æ§é—´éš”ä¸º 30 ç§’
sudo ./cmd/wg-go/wg-go dns utun11 60         # è®¾ç½®ç›‘æ§é—´éš”ä¸º 60 ç§’
```

### è‡ªåŠ¨åŒ–è„šæœ¬

#### quick-start.sh
```bash
sudo ./quick-start.sh                       # å®Œæ•´å¯åŠ¨æµç¨‹
```
- æ£€æŸ¥å¿…è¦æ–‡ä»¶å’Œæƒé™
- åœæ­¢ç°æœ‰è¿æ¥
- å¯åŠ¨å®ˆæŠ¤è¿›ç¨‹
- åº”ç”¨é…ç½®
- é…ç½®ç½‘ç»œæ¥å£å’Œè·¯ç”±
- éªŒè¯è¿æ¥çŠ¶æ€

#### stop-wireguard.sh
```bash
sudo ./stop-wireguard.sh                    # å®Œæ•´åœæ­¢æµç¨‹
```
- åœæ­¢ WireGuard è¿›ç¨‹
- æ¸…ç†ç½‘ç»œæ¥å£
- æ¸…ç†è·¯ç”±è¡¨
- æ¸…ç† socket æ–‡ä»¶
- éªŒè¯æ¸…ç†ç»“æœ

### ç³»ç»Ÿå‘½ä»¤

#### è¿›ç¨‹ç®¡ç†
```bash
ps aux | grep wireguard                     # æŸ¥çœ‹ WireGuard è¿›ç¨‹
sudo pkill wireguard-go                     # åœæ­¢ WireGuard
```

#### ç½‘ç»œè¯Šæ–­
```bash
ifconfig utun11                              # æŸ¥çœ‹æ¥å£çŠ¶æ€
netstat -rn | grep utun11                    # æŸ¥çœ‹è·¯ç”±
lsof -i :51820                              # æŸ¥çœ‹ç«¯å£å ç”¨
```

#### Socket ç®¡ç†
```bash
ls -la /var/run/wireguard/                  # æŸ¥çœ‹ socket æ–‡ä»¶
sudo rm /var/run/wireguard/utun11.sock       # æ¸…ç† socket æ–‡ä»¶
```

---

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. æƒé™ç›¸å…³é—®é¢˜
```bash
# é—®é¢˜: permission denied
# åŸå› : æ²¡æœ‰ä½¿ç”¨ sudo
# è§£å†³: ç¡®ä¿ä½¿ç”¨ sudo è¿è¡Œéœ€è¦ç®¡ç†å‘˜æƒé™çš„å‘½ä»¤
sudo ./cmd/wg-go/wg-go show utun11
sudo ./quick-start.sh
```

#### 2. ç¼–è¯‘é—®é¢˜
```bash
# é—®é¢˜: ç¼–è¯‘å¤±è´¥
# æ£€æŸ¥: Go ç‰ˆæœ¬å’Œç¯å¢ƒ
go version
go env GOOS GOARCH

# è§£å†³: é‡æ–°ç¼–è¯‘
cd cmd/wg-go
go clean
go build -o wg-go
```

#### 3. è¿æ¥é—®é¢˜
```bash
# é—®é¢˜: æ¡æ‰‹å¤±è´¥
# æ£€æŸ¥: ç½‘ç»œè¿é€šæ€§
ping SERVER_IP
nc -u -v SERVER_IP SERVER_PORT

# æ£€æŸ¥: é…ç½®æ–‡ä»¶
cat wg0.conf
sudo ./cmd/wg-go/wg-go show utun11
```

#### 4. åŸŸåè§£æé—®é¢˜
```bash
# é—®é¢˜: åŸŸåæ— æ³•è§£æ
# æ£€æŸ¥: DNS è§£æ
nslookup SERVER_DOMAIN

# ä¸´æ—¶è§£å†³: ä½¿ç”¨ IP åœ°å€
# åœ¨ wg0.conf ä¸­å°† Endpoint æ”¹ä¸º IP:port
```

#### 5. è·¯ç”±é—®é¢˜
```bash
# é—®é¢˜: æ— æ³•è®¿é—® VPN ç½‘ç»œ
# æ£€æŸ¥: è·¯ç”±è¡¨
netstat -rn | grep 192.168.1

# ä¿®å¤: é‡æ–°æ·»åŠ è·¯ç”±
sudo route add -net 192.168.11.0/24 -interface utun11
```

### è°ƒè¯•æŠ€å·§

#### 1. è¯¦ç»†æ—¥å¿—
```bash
# æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—
sudo dmesg | grep -i wireguard
sudo log show --predicate 'process CONTAINS "wireguard"' --last 5m
```

#### 2. ç½‘ç»œæŠ“åŒ…
```bash
# æŠ“å– WireGuard æµé‡ (éœ€è¦å®‰è£… tcpdump)
sudo tcpdump -i utun11
sudo tcpdump -i any port 51820
```

#### 3. é€æ­¥è¯Šæ–­
```bash
# 1. æ£€æŸ¥è¿›ç¨‹
ps aux | grep wireguard

# 2. æ£€æŸ¥æ¥å£
ifconfig utun11

# 3. æ£€æŸ¥é…ç½®
sudo ./cmd/wg-go/wg-go show utun11

# 4. æ£€æŸ¥è·¯ç”±
netstat -rn | grep utun11

# 5. æµ‹è¯•è¿é€šæ€§
ping -c 1 192.168.11.21
```

---

## ğŸ”¬ æŠ€æœ¯è¯´æ˜

### æ ¸å¿ƒæŠ€æœ¯ç‰¹æ€§

#### 1. UAPI åè®®ä¿®å¤
- **é—®é¢˜**: å®˜æ–¹å·¥å…·çš„ `get=1` å‘½ä»¤æ ¼å¼ä¸æ­£ç¡®
- **è§£å†³**: æ­£ç¡®å®ç° `get=1\n\n` æ ¼å¼
- **ä»£ç ä½ç½®**: `cmd/wg-go/uapi.go`

#### 2. æ™ºèƒ½åŸŸåè§£æ
- **åŠŸèƒ½**: è‡ªåŠ¨å°†åŸŸåç«¯ç‚¹è§£æä¸º IP åœ°å€
- **å®ç°**: åœ¨å‘é€ UAPI å‘½ä»¤å‰é¢„è§£æåŸŸå
- **ä»£ç ä½ç½®**: `cmd/wg-go/uapi.go` ä¸­çš„ `resolveEndpoint` å‡½æ•°

#### 2.5. åŠ¨æ€ DNS ç›‘æ§ (æ–°åŠŸèƒ½)
- **åŠŸèƒ½**: è‡ªåŠ¨ç›‘æ§åŸŸåç«¯ç‚¹çš„ IP å˜åŒ–ï¼Œå½“æ£€æµ‹åˆ°å˜åŒ–æ—¶è‡ªåŠ¨é‡æ–°è¿æ¥
- **å®ç°**: åå°å®šæœŸè§£æåŸŸåï¼Œæ¯”è¾ƒ IP å˜åŒ–ï¼Œè‡ªåŠ¨æ›´æ–°ç«¯ç‚¹å¹¶å‘èµ·æ–°æ¡æ‰‹
- **ä»£ç ä½ç½®**: `device/dns_monitor.go` å’Œç›¸å…³ UAPI é›†æˆ
- **ç›‘æ§é—´éš”**: é»˜è®¤ 60 ç§’ï¼Œå¯é€šè¿‡å‘½ä»¤è¡Œé…ç½® (æœ€å° 10 ç§’)
- **æ”¯æŒåœºæ™¯**: åŠ¨æ€ DNS æœåŠ¡ã€äº‘æœåŠ¡å™¨é‡å¯ã€ISP åŠ¨æ€ IP ç­‰

#### 3. å¯†é’¥æ ¼å¼è½¬æ¢
- **é—®é¢˜**: WireGuard UAPI éœ€è¦ hex æ ¼å¼ï¼Œä½†é…ç½®æ–‡ä»¶ä½¿ç”¨ base64
- **è§£å†³**: è‡ªåŠ¨è¿›è¡Œ Base64 â†” Hex è½¬æ¢
- **ä»£ç ä½ç½®**: `cmd/wg-go/crypto.go` å’Œ `cmd/wg-go/uapi.go`

#### 4. è¶…æ—¶å¤„ç†
- **åŠŸèƒ½**: é˜²æ­¢å‘½ä»¤æŒ‚èµ·çš„æ™ºèƒ½è¶…æ—¶æœºåˆ¶
- **å®ç°**: ç½‘ç»œè¿æ¥å’Œè¯»å–æ“ä½œéƒ½æœ‰è¶…æ—¶é™åˆ¶
- **é…ç½®**: è¿æ¥è¶…æ—¶ 5 ç§’ï¼Œè¯»å–è¶…æ—¶ 10 ç§’

#### 5. æƒé™ç®¡ç†
- **åŠŸèƒ½**: æ™ºèƒ½æƒé™æ£€æŸ¥å’Œå‹å¥½æç¤º
- **å®ç°**: æ£€æŸ¥ socket ç›®å½•æƒé™ï¼Œæä¾›è§£å†³å»ºè®®

### æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        wg-go å·¥å…·                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ main.go        â”‚ å‘½ä»¤è§£æå’Œåˆ†å‘                                â”‚
â”‚ commands.go    â”‚ å„ç§å‘½ä»¤çš„å…·ä½“å®ç°                             â”‚
â”‚ uapi.go        â”‚ WireGuard UAPI é€šä¿¡ + åŸŸåè§£æ                â”‚
â”‚ crypto.go      â”‚ å¯†é’¥ç”Ÿæˆã€æ ¼å¼è½¬æ¢                             â”‚
â”‚ monitor.go     â”‚ å®æ—¶ç›‘æ§åŠŸèƒ½                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ UAPI Socket
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    wireguard-go å®ˆæŠ¤è¿›ç¨‹                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ device/        â”‚ WireGuard è®¾å¤‡ç®¡ç†                           â”‚
â”‚ conn/          â”‚ ç½‘ç»œè¿æ¥å¤„ç†                                 â”‚
â”‚ tun/           â”‚ TUN æ¥å£ç®¡ç†                                 â”‚
â”‚ ipc/           â”‚ UAPI æ¥å£å®ç°                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ TUN Interface
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      macOS ç½‘ç»œæ ˆ                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ utun11 æ¥å£     â”‚ è™šæ‹Ÿç½‘ç»œæ¥å£                                 â”‚
â”‚ è·¯ç”±è¡¨         â”‚ ç½‘ç»œè·¯ç”±ç®¡ç†                                 â”‚
â”‚ é˜²ç«å¢™         â”‚ ç½‘ç»œå®‰å…¨ç­–ç•¥                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ–‡ä»¶è¯´æ˜

#### æ ¸å¿ƒæºç æ–‡ä»¶
- **main.go**: ç¨‹åºå…¥å£ï¼Œå‘½ä»¤è¡Œå‚æ•°è§£æå’Œåˆ†å‘
- **commands.go**: å®ç°å„ç§ WireGuard å‘½ä»¤åŠŸèƒ½
- **uapi.go**: WireGuard UAPI åè®®é€šä¿¡å®ç°
- **crypto.go**: å¯†é’¥ç”Ÿæˆã€ç®¡ç†å’Œæ ¼å¼è½¬æ¢
- **monitor.go**: å®æ—¶ç›‘æ§å’ŒçŠ¶æ€æ˜¾ç¤ºåŠŸèƒ½

#### è‡ªåŠ¨åŒ–è„šæœ¬
- **quick-start.sh**: å®Œæ•´çš„è‡ªåŠ¨å¯åŠ¨æµç¨‹
- **stop-wireguard.sh**: å®Œæ•´çš„è‡ªåŠ¨åœæ­¢å’Œæ¸…ç†æµç¨‹

### å…¼å®¹æ€§

#### æ”¯æŒçš„ç³»ç»Ÿ
- **macOS**: å®Œå…¨æ”¯æŒå’Œæµ‹è¯• âœ…
- **Linux**: ç†è®ºæ”¯æŒï¼Œéœ€è¦æµ‹è¯• ğŸ”¶
- **FreeBSD**: ç†è®ºæ”¯æŒï¼Œéœ€è¦æµ‹è¯• ğŸ”¶
- **Windows**: ä¸æ”¯æŒ (ä¸åŒçš„ TUN å®ç°) âŒ

#### Go ç‰ˆæœ¬è¦æ±‚
- **æœ€ä½ç‰ˆæœ¬**: Go 1.19
- **æ¨èç‰ˆæœ¬**: Go 1.21+
- **æµ‹è¯•ç‰ˆæœ¬**: Go 1.21.3

---

## ğŸ¯ æ€»ç»“

è¿™ä¸ª WireGuard-Go å¢å¼ºç‰ˆæœ¬æä¾›äº†ï¼š

âœ… **å®Œæ•´çš„ WireGuard ç®¡ç†å·¥å…·** - æ— éœ€å¤–éƒ¨ä¾èµ–  
âœ… **è‡ªåŠ¨åŒ–è„šæœ¬** - ä¸€é”®å¯åŠ¨å’Œåœæ­¢  
âœ… **æ™ºèƒ½åŠŸèƒ½** - åŸŸåè§£æã€æ ¼å¼è½¬æ¢ã€è¶…æ—¶å¤„ç†  
âœ… **è¯¦ç»†æ–‡æ¡£** - ä»å®‰è£…åˆ°æ•…éšœæ’é™¤çš„å®Œæ•´æŒ‡å—  
âœ… **å®æˆ˜éªŒè¯** - åœ¨ macOS ä¸Šå®Œå…¨æµ‹è¯•é€šè¿‡  

ç°åœ¨æ‚¨å¯ä»¥äº«å—ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€æ˜“äºä½¿ç”¨çš„ WireGuard VPN è§£å†³æ–¹æ¡ˆï¼

---

**éœ€è¦å¸®åŠ©ï¼Ÿ** 
- è¿è¡Œ `./cmd/wg-go/wg-go help` æŸ¥çœ‹å‘½ä»¤å¸®åŠ©
- ä½¿ç”¨ `sudo ./quick-start.sh` å¿«é€Ÿå¼€å§‹
